(function(t){function n(n){for(var r,a,s=n[0],u=n[1],c=n[2],p=0,f=[];p<s.length;p++)a=s[p],o[a]&&f.push(o[a][0]),o[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);l&&l(n);while(f.length)f.shift()();return i.push.apply(i,c||[]),e()}function e(){for(var t,n=0;n<i.length;n++){for(var e=i[n],r=!0,s=1;s<e.length;s++){var u=e[s];0!==o[u]&&(r=!1)}r&&(i.splice(n--,1),t=a(a.s=e[0]))}return t}var r={},o={app:0},i=[];function a(n){if(r[n])return r[n].exports;var e=r[n]={i:n,l:!1,exports:{}};return t[n].call(e.exports,e,e.exports,a),e.l=!0,e.exports}a.m=t,a.c=r,a.d=function(t,n,e){a.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,n){if(1&n&&(t=a(t)),8&n)return t;if(4&n&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(a.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var r in t)a.d(e,r,function(n){return t[n]}.bind(null,r));return e},a.n=function(t){var n=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(n,"a",n),n},a.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},a.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],u=s.push.bind(s);s.push=n,s=s.slice();for(var c=0;c<s.length;c++)n(s[c]);var l=u;i.push([0,"chunk-vendors"]),e()})({0:function(t,n,e){t.exports=e("56d7")},"034f":function(t,n,e){"use strict";var r=e("64a9"),o=e.n(r);o.a},"0f29":function(t,n,e){"use strict";var r=e("5d0b"),o=e.n(r);o.a},"30f8":function(t,n,e){},"56d7":function(t,n,e){"use strict";e.r(n);e("cadf"),e("551c"),e("f751"),e("097d");var r=e("2b0e"),o=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{attrs:{id:"app"}},[e("show-location",{attrs:{country:t.country,distance:t.distance}}),t.markerPosition?e("map-leaflet",{attrs:{marker:t.markerPosition},on:{newMarker:t.updateMarker}}):t._e()],1)},i=[],a=(e("96cf"),e("3b8d")),s=e("f499"),u=e.n(s),c=(e("c5f6"),function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{attrs:{id:"leaflet-map"}})}),l=[],p=e("e11e"),f=e.n(p),h=(e("6cc5"),{props:{marker:Object},data:function(){return{map:null}},mounted:function(){if(this.map=f.a.map("leaflet-map",{center:[43.6044622,1.4442469],zoom:2}),f.a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(this.map),this.map.on("click",this.addMarker),this.marker){var t=f.a.latLng(this.marker.latitude,this.marker.longitude),n=f.a.popup();n.setLatLng(t).openOn(this.map)}},methods:{addMarker:function(t){var n=f.a.popup();n.setLatLng(t.latlng).openOn(this.map),this.$emit("newMarker",{latitude:t.latlng.lat,longitude:t.latlng.lng})}}}),d=h,m=(e("9e5a"),e("2877")),g=Object(m["a"])(d,c,l,!1,null,null,null),v=g.exports,y=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("h2",[t._v("Cliquez sur un pays")]),t.distance?e("p",[t._v("Situé à "+t._s(t.distance)+" km de distance")]):t._e(),t.country?e("img",{attrs:{src:t.src}}):t._e()])},b=[],k={props:{country:String,distance:Number},computed:{src:function(){return"https://www.countryflags.io/".concat(this.country,"/flat/64.png")}}},w=k,M=(e("0f29"),Object(m["a"])(w,y,b,!1,null,"e5d5b8e6",null)),P=M.exports,j=(e("b9b9"),{name:"app",components:{MapLeaflet:v,ShowLocation:P},data:function(){return{position:null,distance:null,country:null,markerPosition:null,ip:null}},methods:{updateMarker:function(t){this.markerPosition=t,this.position&&(this.distance=this.getDistance(this.position,this.markerPosition)),this.getCountry(),this.storePosition(this.markerPosition)},getDistance:function(t,n){var e=function(t){return t*Math.PI/180},r=6378137,o=e(n.latitude-t.latitude),i=e(n.longitude-t.longitude),a=Math.sin(o/2)*Math.sin(o/2)+Math.cos(e(t.latitude))*Math.cos(e(n.latitude))*Math.sin(i/2)*Math.sin(i/2),s=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),u=r*s/1e3;return Number(u.toFixed(2))},storePosition:function(t){var n={ip:this.ip,location:u()(t)};fetch("http://localhost:8000/maprequests/",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:u()(n)}).then(function(t){return t.json()}).catch(console.error)},getCountry:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(){var n,e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,fetch("http://api.geonames.org/countrySubdivisionJSON?lat=".concat(this.markerPosition.latitude,"&lng=").concat(this.markerPosition.longitude,"&username=mathildemichau"));case 2:return n=t.sent,t.next=5,n.json();case 5:e=t.sent,this.country=e.countryCode;case 7:case"end":return t.stop()}},t,this)}));function n(){return t.apply(this,arguments)}return n}()},mounted:function(){var t=this;navigator.geolocation.getCurrentPosition(function(n){t.position=n.coords,t.distance=t.getDistance(t.position,t.markerPosition)}),fetch("http://www.geoplugin.net/json.gp").then(function(t){return t.json()}).then(function(n){return t.ip=n.geoplugin_request}).catch(console.error),fetch("http://localhost:8000/maprequests/").then(function(t){return t.json()}).then(function(n){var e=JSON.parse(n.pop().location);e&&(t.markerPosition=e,t.getCountry())}).catch(console.error)}}),O=j,_=(e("034f"),Object(m["a"])(O,o,i,!1,null,null,null)),x=_.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(t){return t(x)}}).$mount("#app")},"5d0b":function(t,n,e){},"64a9":function(t,n,e){},"9e5a":function(t,n,e){"use strict";var r=e("30f8"),o=e.n(r);o.a}});
//# sourceMappingURL=app.4209b086.js.map